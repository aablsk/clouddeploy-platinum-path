# Service 'store-prod' has 9x capacity than store-v1. We simulate it with 9x pods ands 9x capacity (max-rate-per-endpoint)
#  APP_NAME:         __APP_NAME__
#  PREFIX:           __PREFIX__
#  REGION:           __REGION__
#  K8S_APP_SELECTOR: __K8S_APP_SELECTOR__
# apiVersion: apps/v1
# kind: Deployment #HurricaneAlex
# metadata:
#   name: sol1-__K8S_APP_SELECTOR__-prod
# spec:
#   replicas: 4
#   selector:
#     matchLabels:
#       app: __K8S_APP_SELECTOR__
#       ricc-env: prod
#   template:
#     metadata:
#       labels:
#         app: __K8S_APP_SELECTOR__
#         ricc-env: prod
#     spec:
#       containers:
#       - name: sol1-prod-image-useless #  whereami
#         image: __K8S_APP_IMAGE__ # not _ _ IMAGE_NAME _ _  # gcr.io/google-samples/whereami:v1.2.1
#         ports:
#           - containerPort: 8080
#         env:
#         - name: METADATA
#           value: "sol1-__K8S_APP_SELECTOR__-prod"
# ---
apiVersion: v1
kind: Service
metadata:
  name: sol1-__K8S_APP_SELECTOR__-prod
  annotations:
    networking.gke.io/max-rate-per-endpoint: "90"
    cloud.google.com/neg: '{"exposed_ports": {"8080":{"name": "sol1-__K8S_APP_SELECTOR__-prod-neg"}}}'
spec:
  selector:
    #app: __K8S_APP_SELECTOR__ # TODO_IMPORTANT: re-enable this when it works without. For its enabling ANYTHING to prod :)
    ricc-env: prod
  ports:
  - port: 8080
    targetPort: 8080
